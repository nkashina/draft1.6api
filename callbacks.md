# Что такое хуки. Как они работают
Хуки &ndash; информационный запрос, который отправляется виджетом и обрабатывается на стороне партнера обрабатывает сервис-слушатель. При выполнении флоу покупки или продажи в виджете последовательно проходят несколько типов и состояний вебхуков.

# Схема отправки вебхуков

**Buy:**

1. `top_up` 
2. `withdrawal`
3. `deposit`

**Sell:**

1. `top_up`
2. `withdrawal`
3. `deposit`

Каждый из типов проходит по схеме

`New` -> `Pending` -> `Complete`

В случае ошибки - последним статусом становиться ошибка

# partners.mercuryo.io

Информация об отправленных хуках и их статусе можно найти по адресу

partners.mercuryo.io

Во вкладке **Widget Callbacks**

![menu](menu_img)

# Widget Callbacks
## Тестовый callback

Для проверки обработки вебхука, можно отправить тестовый колбек.

Шаги:
1. Выбрать тип транзакции в поле **Transaction Type**
2. Выбрать статус транзакции в поле **Transaction Status**
3. Выбрать свой виджет в поле **Widget Id**
4. Нажать на кнопку **Send test callback**

![test](test_img)

## Таблица Callback Events

![table](table_img)

1. **Id** &ndash; уникальный ID вебхука
2. **Status** &ndash; статус колбека
3. **Widget** &ndash; ID виджета, связь виджета и его ID можно найти в разделе меню My widgets
4. **Created At** &ndash; время создания запроса
5. **Actions** &ndash; кнопка Actions открывает подробную информацию об конкретном ивенте

# Расследование ошибки
## Статус колбека

Упешно доставленные колбеки помечаются статусом **Success**

![success](success_img)

Для неудачных попыток отправки в поле **Status** помечаетя ошибка, из-за которой не удалось доставить колбек. Промежуток для каждой последующая попытки доставки запроса увеличивается вдвое

![fail](fail_img)

Если в поле **Status** отображается **404** ошибка &ndash; значит не найден адрес куда следует отправить колбек

## Причина ошибки

Причина ошибки &ndash сервис-слушатель некорректно обрабатывет поля в теле запроса.

Чтобы понять, какая именно строчка обрабатывается нужно открыть подробную информаци о запросе нажав на кнопку **Action**

![callback_info](callback_info_img)

1. **ID** &ndash; ID колбека, так же находится в шапке 
2. **Widget ID** &ndash; ID виджета, связь виджета и его ID можно найти в разделе меню My widgets
3. **Transaction ID** &ndash; ID транзакции
4. **Payload** &ndash; информация содержащаяся в запросе. Именно тут можно найти, какие строчки не обрабатывает сервис-слушатель
5. **Is Delivered** &ndash; статуст доставки, может быть **Yes** и **No**
6. **Created At** &ndash; время создания запроса
7. **Updated At** &ndash; время последнего обнавления статуса запроса
